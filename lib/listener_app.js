
var ser_rastreo=require('./ser_rastreo');var CM_Trama=require('./CM_Trama');var moment=require('moment-timezone');var emit=require('./emit');module.exports={on:on};function on(socket){socket.on('rc_',function(idEquipo,respuesta,trama,confirmacion){if(typeof confirmacion==="function"){return confirmacion({en:1});}});socket.on('t_',function(trama,confirmacion){if(typeof confirmacion==="function"){trama['fD']=trama['fD']+'.000Z';trama['fR']=moment().tz('Africa/Bissau').format().replace(/T/,' ').replace(/\..+/,'').substring(0,19)+'.000Z';trama['iEt']=ID_MOVIL;ser_rastreo.notificarTrama(ID_MOVIL,trama['iE'],trama);CM_Trama.guardar(trama);return confirmacion({en:1});}});socket.on('l_',function(lote,confirmacion){if(typeof confirmacion==="function"){let fR=moment().tz('Africa/Bissau').format().replace(/T/,' ').replace(/\..+/,'').substring(0,19)+'.000Z';lote.forEach(trama=>{trama['fR']=fR;trama['fD']=trama['fD']+'.000Z';trama['iEt']=ID_MOVIL;CM_Trama.guardar(trama);});return confirmacion({en:1});}});}